<!doctype HTML>
<html>
<head>
    <base href="/">
    <script type="text/javascript" src="/lib/require-jquery.js"></script>
    <script type="text/javascript">
        requirejs(['game-entities/code.js',
            'game-entities/footman.js',
            'game-entities/cohort.js',
            'game-entities/game.js',
            'game-entities/rules.js',
            'game-runner/logger.js',
            'game-runner/player.js'], function(Code, Footman, Cohort, Game, Rules, Logger, Player) {
            var tactic = new Code(
"resetQueue();\
var _target = target();\
if (!_target || _target.lives <= 0) {\
    _target = nearest();\
}\
if (canAttack(_target)) {\
    attack(_target);\
} else {\
    turn(direction(_target));\
    move(distance(_target));\
}");
            var rules = new Rules();
            var cohort1 = new Cohort([new Footman(tactic, rules), new Footman(tactic, rules), new Footman(tactic, rules)], new Code(
"var _enemies = enemies(), _confederates = confederates();\
for (var i in _enemies) {\
    if (_enemies[i].lives > 0) {\
        for (var j in _confederates) {\
            setTarget(_confederates[j], _enemies[i])\
        }\
    }\
}\
"));
            var cohort2 = new Cohort([new Footman(tactic, rules), new Footman(tactic, rules), new Footman(tactic, rules)], new Code(''));
            var game = new Game(cohort1, cohort2);
            var logger = new Logger(game);

            var player = new Player(logger, $('#field').get(0));

            var steps = 40;

            window.interval = setInterval(function(){
                var res = game.step();
                if (res == false) {
                    steps--;
                    if (steps == 0) {
                        console.log(res);
                        clearInterval(interval);
                    }
                } else {
                    console.log(res);
                    clearInterval(interval);
                }
            }, 300);
        });
    </script>
</head>
<body>
    <canvas id="field" width="600" height="300" style="border: solid 1px #ccc;"></canvas>
    <button onclick="clearInterval(window.interval)">Стоп</button>
</body>
</html>